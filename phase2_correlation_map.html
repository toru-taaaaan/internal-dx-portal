<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2 Correlation Map | Internal DX Portal</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            overflow: hidden;
            margin: 0;
            height: 100vh;
        }
        .node {
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .node:hover circle {
            stroke-width: 4px;
            stroke: #fff;
        }
        .link {
            stroke: #334155;
            stroke-opacity: 0.4;
            stroke-width: 2px;
            fill: none;
        }
        .link-label {
            font-size: 10px;
            font-weight: 700;
            fill: #64748b;
            text-anchor: middle;
            pointer-events: none;
            background: #0f172a;
        }
        .label {
            font-size: 11px;
            font-weight: 800;
            pointer-events: none;
            fill: #94a3b8;
            letter-spacing: 0.05em;
        }
        .layer-label {
            font-size: 10px;
            font-weight: 900;
            fill: #334155;
            text-anchor: end;
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }
        .tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid #334155;
            padding: 20px;
            border-radius: 16px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.5);
            z-index: 100;
            max-width: 320px;
        }
        .header {
            position: absolute;
            top: 40px;
            left: 40px;
            z-index: 10;
        }
        .bg-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, #1e293b 0%, #0f172a 100%);
            z-index: -1;
        }
        .layer-line {
            stroke: #1e293b;
            stroke-width: 1px;
            stroke-dasharray: 4 4;
        }
    </style>
</head>
<body>
    <div class="bg-glow"></div>
    
    <div class="header">
        <h1 class="text-3xl font-black tracking-tighter text-white mb-2 italic">PHASE 2 RELATIONSHIP</h1>
        <p class="text-slate-500 text-[10px] font-black tracking-[0.3em] uppercase">Architecture Correlation Logic</p>
        <div class="flex gap-4 mt-6">
            <a href="index.html" class="px-5 py-2.5 bg-slate-800/50 backdrop-blur border border-slate-700 rounded-full text-[10px] font-black tracking-widest hover:bg-slate-700 transition">‚Üê COMMAND CENTER</a>
        </div>
    </div>

    <div id="map-container" class="w-full h-full"></div>
    <div id="tooltip" class="tooltip"></div>

    <script>
        const data = {
            "nodes": [
                { "id": "p2_mgmt", "title": "Phase 2 Plan", "group": "management", "layer": 2, "url": "project_management.html", "symbol": "üìÖ", "desc": "Phase 2 ÂÖ®‰Ωì„ÅÆÁµ±ÂêàÁÆ°ÁêÜ„ÉªÂ∑•Á®ã„Éª„Çø„Çπ„ÇØ" },
                { "id": "p15_01", "title": "AD Cloud Lift", "group": "identity", "layer": 1, "url": "project_15_01.html", "symbol": "üîë", "desc": "IDÁÆ°ÁêÜÂü∫Áõ§„ÅÆ„ÇØ„É©„Ç¶„ÉâÁßªË°å„ÄÇDX„ÅÆ„Ç≥„Ç¢„Å®„Å™„ÇãË™çË®ºÁ≥ª" },
                { "id": "p15_02", "title": "Secom Cloud", "group": "security", "layer": 1, "url": "project_15_02.html", "symbol": "üõ°Ô∏è", "desc": "„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç≤„Éº„Éà„Ç¶„Çß„Ç§„ÅÆÂº∑Èù≠Âåñ„ÄÇÂ¢ÉÁïåÈò≤Âæ°„ÅÆË¶Å" },
                { "id": "p15_combined", "title": "Integration Analysis", "group": "analysis", "layer": 2, "url": "project_15_combined.html", "symbol": "‚öñÔ∏è", "desc": "AD„Å®Secom„ÅÆ„Ç≥„Çπ„Éà„ÉªÊäÄË°ì„Ç∑„Éä„Ç∏„Éº„ÅÆÁµ±ÂêàÂàÜÊûê" },
                { "id": "p_ad_strategy", "title": "AD Scenarios", "group": "strategy", "layer": 2, "url": "project_ad_scenarios.html", "symbol": "üéØ", "desc": "ÁßªË°å„Ç∑„Éä„É™„Ç™ÔºàLBO/Âà∑Êñ∞Ôºâ„ÅÆÊà¶Áï•ÁöÑÊØîËºÉ" },
                { "id": "p_ad_matrix", "title": "Responsibility Matrix", "group": "management", "layer": 2, "url": "project_ad_matrix.html", "symbol": "üìã", "desc": "ÈÅãÁî®Â¢ÉÁïå„Å®Ë≤¨‰ªª„ÅÆÊòéÁ¢∫ÂåñÔºà3Á§æÈñìÂêàÊÑèÔºâ" },
                { "id": "sdwan_map", "title": "SD-WAN Visual", "group": "network", "layer": 0, "url": "line_dashboard.html", "symbol": "üåê", "desc": "Êã†ÁÇπÈñìÈÄö‰ø°ÁµåË∑Ø„ÅÆÂèØË¶ñÂåñ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ" },
                { "id": "sdwan_strategy", "title": "SD-WAN Strategy", "group": "strategy", "layer": 0, "url": "SD-WANÂà∑Êñ∞_3Á§æ4„Ç∑„Éä„É™„Ç™ÊØîËºÉÊ§úË®éË≥áÊñô.html", "symbol": "üöÄ", "desc": "ÂõûÁ∑öÂà∑Êñ∞„ÉªSD-WAN„Å´„Çà„ÇãÈÄö‰ø°ÂúüÂè∞„ÅÆÂº∑Èù≠Âåñ" }
            ],
            "links": [
                { "source": "sdwan_strategy", "target": "p15_01", "label": "ÂÆâÂÖ®„Å™Ëª¢ÈÄÅË∑Ø„ÅÆÊèê‰æõ" },
                { "source": "sdwan_strategy", "target": "sdwan_map", "label": "Ë¶ñË¶öÁöÑÁÆ°ÁêÜ" },
                { "source": "p15_01", "target": "p15_02", "label": "Ë™çË®ºÈÄ£Êê∫" },
                { "source": "p15_02", "target": "sdwan_strategy", "label": "Â¢ÉÁïåÈò≤Âæ°" },
                { "source": "p15_01", "target": "p_ad_strategy", "label": "Êà¶Áï•ÁöÑÊ†πÊã†" },
                { "source": "p15_01", "target": "p_ad_matrix", "label": "Ê®©ÈôêÂÆöÁæ©" },
                { "source": "p15_01", "target": "p15_combined", "label": "Áµ±ÂêàÂàÜÊûê" },
                { "source": "p15_02", "target": "p15_combined", "label": "Áµ±ÂêàÂàÜÊûê" },
                { "source": "p2_mgmt", "target": "p15_01", "label": "Êé®ÈÄ≤" },
                { "source": "p2_mgmt", "target": "p15_02", "label": "Êé®ÈÄ≤" },
                { "source": "p2_mgmt", "target": "sdwan_strategy", "label": "Êé®ÈÄ≤" }
            ]
        };

        const width = window.innerWidth;
        const height = window.innerHeight;

        const svg = d3.select("#map-container")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Layers setup
        const layerPositions = [height * 0.75, height * 0.5, height * 0.25];
        const layerNames = ["Foundation (Network)", "Core (Identity/Security)", "Strategy & Management"];

        layerPositions.forEach((y, i) => {
            svg.append("line")
                .attr("class", "layer-line")
                .attr("x1", 100)
                .attr("y1", y)
                .attr("x2", width - 100)
                .attr("y2", y);
            
            svg.append("text")
                .attr("class", "layer-label")
                .attr("x", width - 120)
                .attr("y", y - 10)
                .text(layerNames[i]);
        });

        const simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links).id(d => d.id).distance(220).strength(0.5))
            .force("charge", d3.forceManyBody().strength(-1000))
            .force("x", d3.forceX(width / 2).strength(0.1))
            .force("y", d3.forceY(d => layerPositions[d.layer]).strength(2))
            .force("collision", d3.forceCollide().radius(80));

        const colors = {
            management: "#3b82f6",
            identity: "#06b6d4",
            security: "#f43f5e",
            network: "#10b981",
            strategy: "#8b5cf6",
            analysis: "#f59e0b"
        };

        // Link groups
        const linkGroup = svg.append("g").selectAll(".link-group")
            .data(data.links)
            .join("g")
            .attr("class", "link-group");

        const link = linkGroup.append("line")
            .attr("class", "link");

        const linkLabel = linkGroup.append("text")
            .attr("class", "link-label")
            .text(d => d.label);

        const node = svg.append("g")
            .selectAll("g")
            .data(data.nodes)
            .join("g")
            .attr("class", "node")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended))
            .on("click", (e, d) => window.location.href = d.url)
            .on("mouseover", showTooltip)
            .on("mouseout", hideTooltip);

        node.append("circle")
            .attr("r", 32)
            .attr("fill", d => colors[d.group] || "#475569")
            .attr("fill-opacity", 0.1)
            .attr("stroke", d => colors[d.group] || "#475569")
            .attr("stroke-width", 1.5);

        node.append("text")
            .attr("text-anchor", "middle")
            .attr("dy", ".35em")
            .attr("font-size", "22px")
            .text(d => d.symbol);

        node.append("text")
            .attr("class", "label")
            .attr("text-anchor", "middle")
            .attr("dy", "50px")
            .text(d => d.title.toUpperCase());

        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            linkLabel
                .attr("x", d => (d.source.x + d.target.x) / 2)
                .attr("y", d => (d.source.y + d.target.y) / 2 - 5);

            node
                .attr("transform", d => `translate(${d.x},${d.y})`);
        });

        function dragstarted(event) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            event.subject.fx = event.subject.x;
            event.subject.fy = event.subject.y;
        }

        function dragged(event) {
            event.subject.fx = event.x;
            event.subject.fy = event.y;
        }

        function dragended(event) {
            if (!event.active) simulation.alphaTarget(0);
            event.subject.fx = null;
            event.subject.fy = null;
        }

        const tooltip = d3.select("#tooltip");

        function showTooltip(event, d) {
            tooltip.transition().duration(200).style("opacity", 1);
            tooltip.html(`
                <div class="flex items-center gap-2 mb-3">
                    <span class="px-2 py-0.5 rounded text-[8px] font-black text-white uppercase tracking-widest" style="background:${colors[d.group]}">${d.group}</span>
                </div>
                <div class="text-xl font-black text-white mb-2 leading-tight tracking-tight">${d.title}</div>
                <div class="text-[11px] text-slate-400 mb-5 leading-relaxed font-bold">${d.desc}</div>
                <div class="flex items-center justify-between pt-4 border-t border-slate-700/50">
                    <span class="text-[9px] font-black text-slate-500 uppercase tracking-widest">Interaction</span>
                    <span class="text-[9px] font-black text-blue-500 uppercase tracking-widest leading-none">Open Document ‚Üí</span>
                </div>
            `)
            .style("left", (event.pageX + 25) + "px")
            .style("top", (event.pageY - 25) + "px");
            
            // Highlight links
            link.filter(l => l.source.id === d.id || l.target.id === d.id)
                .transition().duration(200)
                .style("stroke", colors[d.group])
                .style("stroke-opacity", 1)
                .style("stroke-width", 3);
        }

        function hideTooltip() {
            tooltip.transition().duration(200).style("opacity", 0);
            link.transition().duration(200)
                .style("stroke", "#334155")
                .style("stroke-opacity", 0.4)
                .style("stroke-width", 2);
        }

        window.addEventListener('resize', () => {
            const w = window.innerWidth;
            const h = window.innerHeight;
            svg.attr("width", w).attr("height", h);
            simulation.force("center", d3.forceCenter(w / 2, h / 2)).restart();
        });
    </script>
</body>
</html>
