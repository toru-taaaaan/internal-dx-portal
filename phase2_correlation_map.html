<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2 Strategy Flow | Internal DX Portal</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            overflow: hidden;
            margin: 0;
            height: 100vh;
        }
        .node {
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .node:hover circle {
            stroke-width: 4px;
            stroke: #fff;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));
        }
        .link {
            stroke: #334155;
            stroke-opacity: 0.3;
            stroke-width: 2px;
            fill: none;
            marker-end: url(#arrowhead);
        }
        .link-label {
            font-size: 9px;
            font-weight: 800;
            fill: #475569;
            text-anchor: middle;
            pointer-events: none;
        }
        .label {
            font-size: 11px;
            font-weight: 900;
            pointer-events: none;
            fill: #94a3b8;
            letter-spacing: 0.02em;
        }
        .stage-label {
            font-size: 10px;
            font-weight: 900;
            fill: #1e293b;
            text-anchor: middle;
            letter-spacing: 0.4em;
            text-transform: uppercase;
        }
        .tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(16px);
            border: 1px solid #334155;
            padding: 20px;
            border-radius: 16px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
            z-index: 100;
            max-width: 320px;
        }
        .header {
            position: absolute;
            top: 40px;
            left: 40px;
            z-index: 10;
        }
        .bg-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, #111827 0%, #030712 100%);
            z-index: -1;
        }
        .stage-line {
            stroke: #111827;
            stroke-width: 2px;
            stroke-dasharray: 8 8;
        }
        .stage-bg {
            fill: none;
        }
    </style>
</head>
<body>
    <div class="bg-glow"></div>
    
    <div class="header">
        <h1 class="text-3xl font-black tracking-tighter text-white mb-2">PHASE 2 NARRATIVE FLOW</h1>
        <p class="text-slate-500 text-[10px] font-black tracking-[0.3em] uppercase">Contextual Strategy Map: AS-IS ‚Üí PAIN ‚Üí TO-BE</p>
        <div class="flex gap-4 mt-6">
            <a href="index.html" class="px-5 py-2.5 bg-slate-800/50 backdrop-blur border border-slate-700 rounded-full text-[10px] font-black tracking-widest hover:bg-slate-700 transition">‚Üê BACK TO HUB</a>
        </div>
    </div>

    <div id="map-container" class="w-full h-full"></div>
    <div id="tooltip" class="tooltip"></div>

    <script>
        const data = {
            "nodes": [
                { "id": "as_is_ad", "title": "ÁèæÁä∂: „Ç™„É≥„Éó„É¨AD", "group": "asis", "stage": 0, "symbol": "üèõÔ∏è", "desc": "Êú¨Á§æÂ±ã‰∏ä„Å´Ë®≠ÁΩÆ„Åï„Çå„ÅüÁâ©ÁêÜ„Çµ„Éº„Éê„Éº‰∏ä„Åß„ÅÆÈÅãÁî®„ÄÇÈúáÁÅΩ„ÇÑË®≠ÂÇô„Éà„É©„Éñ„É´„Å´ËÑÜÂº±„ÄÇ" },
                { "id": "pain_ad", "title": "Ë™≤È°å: Áâ©ÁêÜÊïÖÈöú„ÉªËÄÅÊúΩÂåñ", "group": "pain", "stage": 1, "symbol": "‚ö†Ô∏è", "desc": "„Éè„Éº„ÉâÊïÖÈöú„Å´„Çà„ÇãÂÖ®Á§æÂÅúÊ≠¢„É™„Çπ„ÇØ(SPOF)„ÄÇ‰øÆÁêÜÈÉ®Êùê„ÅÆÊûØÊ∏á„ÇÇÊá∏Âøµ„ÄÇ" },
                { "id": "sol_ad_lift", "title": "AD Cloud Lift (15.01)", "group": "solution", "stage": 2, "url": "project_15_01.html", "symbol": "üîë", "desc": "„ÇØ„É©„Ç¶„Éâ(IaaS)ÁßªË°å„Å´„Çà„ÇãÁâ©ÁêÜ„É™„Çπ„ÇØ„ÅÆÂÆåÂÖ®ÊéíÈô§„ÄÇË™çË®ºÁ≥ªBCP„ÅÆË¶Å„ÄÇ" },
                { "id": "sol_ad_strat", "title": "ADÁßªË°åÊà¶Áï•ÊØîËºÉ", "group": "solution", "stage": 2, "url": "project_ad_scenarios.html", "symbol": "üéØ", "desc": "ÂçòÁ¥îÂª∂ÂëΩ„Åã„ÄÅÊúÄÊñ∞Áí∞Â¢É„Å∏„ÅÆÂà∑Êñ∞„Åã„ÄÇÂ∞ÜÊù•„Ç≥„Çπ„Éà„Å®„É™„Çπ„ÇØ„ÅÆÊØîËºÉË≥áÊñô„ÄÇ" },
                
                { "id": "as_is_nw", "title": "ÁèæÁä∂: VPNÈÄö‰ø°", "group": "asis", "stage": 0, "symbol": "üìâ", "desc": "Vario-VPN„Å´„Çà„ÇãÊã†ÁÇπÊé•Á∂ö„ÄÇ„Çª„É≥„Çø„ÉºÔºàÊú¨Á§æÔºâÈõÜ‰∏≠Âûã„ÅÆ„É¨„Ç¨„Ç∑„ÉºÊßãÊàê„ÄÇ" },
                { "id": "pain_nw", "title": "Ë™≤È°å: ÈÄö‰ø°„Éú„Éà„É´„Éç„ÉÉ„ÇØ", "group": "pain", "stage": 1, "symbol": "üêå", "desc": "„É™„É¢„Éº„ÉàÂ¢ó„Éª„ÇØ„É©„Ç¶„ÉâÊã°Â§ß„Å´‰º¥„ÅÜÂ∏ØÂüü‰∏çË∂≥„ÄÇÁâπ„Å´Â§ßÈò™Êã†ÁÇπ„ÅÆ„É¨„Çπ„Éù„É≥„ÇπÊÇ™Âåñ„ÄÇ" },
                { "id": "sol_sdwan", "title": "SD-WANÂà∑Êñ∞Ë≥áÊñô", "group": "solution", "stage": 2, "url": "SD-WANÂà∑Êñ∞_3Á§æ4„Ç∑„Éä„É™„Ç™ÊØîËºÉÊ§úË®éË≥áÊñô.html", "symbol": "üöÄ", "desc": "3Á§æ4Ê°à„ÅÆÊØîËºÉ„ÄÇÂõûÁ∑öÂà∑Êñ∞„Å®SD-WAN„Å´„Çà„ÇãÂ∏ØÂüüÁ¢∫‰øù„ÉªÂÜóÈï∑Âåñ„ÅÆÊ§úË®é„ÄÇ" },
                { "id": "sol_nw_map", "title": "SD-WAN Visual", "group": "solution", "stage": 2, "url": "line_dashboard.html", "symbol": "üåê", "desc": "Âà∑Êñ∞Âæå„ÅÆÈÄö‰ø°ÁµåË∑Ø„ÇíÂú∞Âõ≥‰∏ä„ÅßÂèØË¶ñÂåñ„Åó„Åü„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„ÉñË≥áÊñô„ÄÇ" },

                { "id": "as_is_sec", "title": "ÁèæÁä∂: ÂæìÊù•ÂûãUTM", "group": "asis", "stage": 0, "symbol": "üß±", "desc": "Á§æÂÜÖ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÅÆÂ¢ÉÁïå„ÅÆ„Åø„ÇíÂ¢ÉÁïåÂûãFW„ÅßÂÆà„ÇãÂæìÊù•ÊñπÂºè„ÄÇ" },
                { "id": "pain_sec", "title": "Ë™≤È°å: ÊåÅÂá∫PC„ÅÆÁµ±Âà∂‰∏çË∂≥", "group": "pain", "stage": 1, "symbol": "üïµÔ∏è", "desc": "Á§æÂ§ñ„Åß„ÅÆÂà©Áî®ÊôÇ„Å´„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÅåÈÅ©Áî®„Åï„Çå„Åö„ÄÅ„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà„ÅÆ„É™„Çπ„ÇØÂ¢ó„ÄÇ" },
                { "id": "sol_secom", "title": "Secom Cloud (15.02)", "group": "solution", "stage": 2, "url": "project_15_02.html", "symbol": "üõ°Ô∏è", "desc": "„ÇØ„É©„Ç¶„ÉâÂûãSWG„Å´„Çà„Çã„ÄåÂ†¥ÊâÄ„ÇíÂïè„Çè„Å™„ÅÑ„Äç‰øùË≠∑„Å®„Çª„Ç≠„É•„Ç¢„Å™IDÊßãÊàê„ÄÇ" },
                
                { "id": "sol_combined", "title": "Áµ±ÂêàÂàÜÊûêË≥áÊñô", "group": "solution", "stage": 2, "url": "project_15_combined.html", "symbol": "‚öñÔ∏è", "desc": "AD„Å®Secom„ÅÆÂêÑÊ°à„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„ÅüTCOÔºà„Éà„Éº„Çø„É´„Ç≥„Çπ„ÉàÔºâ„ÅÆÊúÄÁµÇÊØîËºÉË≥áÊñô„ÄÇ" }
            ],
            "links": [
                { "source": "as_is_ad", "target": "pain_ad", "label": "ËÄÅÊúΩÂåñ„ÉªSPOF" },
                { "source": "pain_ad", "target": "sol_ad_lift", "label": "BCPÂØæÁ≠ñ" },
                { "source": "sol_ad_lift", "target": "sol_ad_strat", "label": "Êà¶Áï•Ê±∫ÂÆö" },
                
                { "source": "as_is_nw", "target": "pain_nw", "label": "„Éà„É©„Éï„Ç£„ÉÉ„ÇØÂ¢ó" },
                { "source": "pain_nw", "target": "sol_sdwan", "label": "SD-WANÂåñ" },
                { "source": "sol_sdwan", "target": "sol_nw_map", "label": "ÊßãÊàêÂèØË¶ñÂåñ" },
                
                { "source": "as_is_sec", "target": "pain_sec", "label": "Â¢ÉÁïåÊ∂àÂ§±" },
                { "source": "pain_sec", "target": "sol_secom", "label": "Â†¥ÊâÄ„ÇíÈÅ∏„Å∞„Å¨‰øùË≠∑" },
                
                { "source": "sol_ad_lift", "target": "sol_combined", "label": "„Çª„ÉÉ„ÉàÂ∞éÂÖ•ÂàÜÊûê" },
                { "source": "sol_secom", "target": "sol_combined", "label": "„Çª„ÉÉ„ÉàÂ∞éÂÖ•ÂàÜÊûê" },
                { "source": "sol_sdwan", "target": "sol_ad_lift", "label": "ÂúüÂè∞„ÅÆÁ¢∫‰øù" }
            ]
        };

        const width = window.innerWidth;
        const height = window.innerHeight;

        const svg = d3.select("#map-container")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Marker for arrows
        svg.append("defs").append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "-0 -5 10 10")
            .attr("refX", 38)
            .attr("refY", 0)
            .attr("orient", "auto")
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("xoverflow", "visible")
            .append("svg:path")
            .attr("d", "M 0,-5 L 10 ,0 L 0,5")
            .attr("fill", "#334155")
            .style("stroke", "none");

        // Stages setup
        const stageOffsets = [width * 0.2, width * 0.5, width * 0.8];
        const stageNames = ["AS-IS (ÁèæÁä∂)", "PAIN (Ë™≤È°å„Éª„É™„Çπ„ÇØ)", "TO-BE (Ê§úË®éË≥áÊñô„ÉªËß£Ê±∫Á≠ñ)"];

        stageOffsets.forEach((x, i) => {
            svg.append("line")
                .attr("class", "stage-line")
                .attr("x1", x)
                .attr("y1", 100)
                .attr("x2", x)
                .attr("y2", height - 100);
            
            svg.append("text")
                .attr("class", "stage-label")
                .attr("x", x)
                .attr("y", 80)
                .text(stageNames[i]);
        });

        const simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links).id(d => d.id).distance(200).strength(0.3))
            .force("charge", d3.forceManyBody().strength(-800))
            .force("x", d3.forceX(d => stageOffsets[d.stage]).strength(2))
            .force("y", d3.forceY(height / 2).strength(0.1))
            .force("collision", d3.forceCollide().radius(70));

        const colors = {
            asis: "#475569",
            pain: "#ef4444",
            solution: "#3b82f6"
        };

        const linkGroup = svg.append("g").selectAll(".link-group")
            .data(data.links)
            .join("g")
            .attr("class", "link-group");

        const link = linkGroup.append("line")
            .attr("class", "link");

        const linkLabel = linkGroup.append("text")
            .attr("class", "link-label")
            .text(d => d.label);

        const node = svg.append("g")
            .selectAll("g")
            .data(data.nodes)
            .join("g")
            .attr("class", "node")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended))
            .on("click", (e, d) => {
                if (d.url) window.location.href = d.url;
            })
            .on("mouseover", showTooltip)
            .on("mouseout", hideTooltip);

        node.append("circle")
            .attr("r", 32)
            .attr("fill", d => colors[d.group])
            .attr("fill-opacity", 0.08)
            .attr("stroke", d => colors[d.group])
            .attr("stroke-width", 2);

        node.append("text")
            .attr("text-anchor", "middle")
            .attr("dy", ".35em")
            .attr("font-size", "22px")
            .text(d => d.symbol);

        node.append("text")
            .attr("class", "label")
            .attr("text-anchor", "middle")
            .attr("dy", "50px")
            .text(d => d.title);

        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            linkLabel
                .attr("x", d => (d.source.x + d.target.x) / 2)
                .attr("y", d => (d.source.y + d.target.y) / 2 - 10);

            node
                .attr("transform", d => `translate(${d.x},${d.y})`);
        });

        function dragstarted(event) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            event.subject.fx = event.subject.x;
            event.subject.fy = event.subject.y;
        }

        function dragged(event) {
            event.subject.fx = event.x;
            event.subject.fy = event.y;
        }

        function dragended(event) {
            if (!event.active) simulation.alphaTarget(0);
            event.subject.fx = null;
            event.subject.fy = null;
        }

        const tooltip = d3.select("#tooltip");

        function showTooltip(event, d) {
            tooltip.transition().duration(200).style("opacity", 1);
            tooltip.html(`
                <div class="flex items-center gap-2 mb-3">
                    <span class="px-2 py-0.5 rounded text-[8px] font-black text-white uppercase tracking-widest" style="background:${colors[d.group]}">${d.group}</span>
                </div>
                <div class="text-xl font-black text-white mb-2 leading-tight tracking-tight">${d.title}</div>
                <div class="text-[11px] text-slate-400 mb-5 leading-relaxed font-bold">${d.desc}</div>
                ${d.url ? `
                <div class="flex items-center justify-between pt-4 border-t border-slate-700/50">
                    <span class="text-[9px] font-black text-slate-500 uppercase tracking-widest">Action</span>
                    <span class="text-[9px] font-black text-blue-500 uppercase tracking-widest leading-none">Open Document ‚Üí</span>
                </div>` : ''}
            `)
            .style("left", (event.pageX + 25) + "px")
            .style("top", (event.pageY - 25) + "px");
            
            link.filter(l => l.source.id === d.id || l.target.id === d.id)
                .transition().duration(200)
                .style("stroke", colors[d.group])
                .style("stroke-opacity", 1)
                .style("stroke-width", 3);
        }

        function hideTooltip() {
            tooltip.transition().duration(200).style("opacity", 0);
            link.transition().duration(200)
                .style("stroke", "#334155")
                .style("stroke-opacity", 0.3)
                .style("stroke-width", 2);
        }

        window.addEventListener('resize', () => {
            const w = window.innerWidth;
            const h = window.innerHeight;
            svg.attr("width", w).attr("height", h);
            simulation.alpha(0.3).restart();
        });
    </script>
</body>
</html>
