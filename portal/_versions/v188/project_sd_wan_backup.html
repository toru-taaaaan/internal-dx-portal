<!DOCTYPE html>
<html lang="ja">

<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SD-WAN Comparison - Internal DX Portal</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #3b82f6;
            --accent: #10b981;
            --bg-body: #f8fafc;
            --surface: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius-lg: 16px;
            --radius-md: 12px;
        }

        body {
            font-family: 'Outfit', 'Inter', "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            line-height: 1.6;
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 24px 24px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.02em;
        }

        .back-link {
            color: var(--text-muted);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
            padding: 8px 16px;
            border-radius: var(--radius-md);
            background: white;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
        }

        .back-link:hover {
            color: var(--primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .controls {
            margin-bottom: 30px;
            background: white;
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: var(--shadow-md);
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .toggle-btn {
            border: none;
            background: none;
            padding: 12px 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-muted);
            border-radius: 20px;
            transition: all 0.3s;
            font-family: 'Outfit', sans-serif;
        }

        .toggle-btn.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
        }

        #chart {
            background-color: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            width: 100%;
            height: 600px;
            position: relative;
            margin-bottom: 30px;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 10px 14px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }

        .card {
            background: white;
            backdrop-filter: blur(12px);
            border-radius: var(--radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.5);
            margin-bottom: 24px;
        }

        .card h2,
        .card h3 {
            color: var(--text-main);
            margin-top: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th,
        td {
            padding: 12px;
            border: 1px solid var(--border);
            text-align: left;
        }

        th {
            background-color: #f8fafc;
            font-weight: 600;
            color: var(--text-muted);
        }

        .highlight-green {
            background-color: #ecfdf5;
        }

        .highlight-orange {
            background-color: #fff7ed;
        }

        .highlight-red {
            background-color: #ffebee;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>SD-WAN Comparison</h1>
            <? var url = ScriptApp.getService().getUrl(); ?>
            <a href="<?= url ?>" class="back-link">â† Back to Portal</a>
        </div>

        <div class="controls">
            <button class="toggle-btn active" id="btn-current" onclick="setMode('current')">Current: Hub & Spoke
                (VPN)</button>
            <button class="toggle-btn" id="btn-future" onclick="setMode('future')">Future: SD-WAN (Direct)</button>
        </div>

        <div id="chart"></div>
        <div id="tooltip" class="tooltip"></div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background:#4285F4"></div>Internet/SaaS
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background:#EA4335"></div>HQ / Bottleneck
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background:#34A853"></div>Safe / Direct
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background:#FBBC05"></div>Branch Office
            </div>
        </div>

        <div id="description-box" class="card" style="display: none;"></div>

        <div class="card">
            <h2 style="text-align: center; color: #1a237e; border-bottom: 2px solid #ea4335; padding-bottom: 10px;">
                ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ å®Œå…¨æ¯”è¼ƒè¡¨</h2>
            <p style="text-align: center; color: #666; font-size: 12px; margin-bottom: 30px;">
                âš ï¸ <strong>æ³¨æ„</strong>: IIJ Managed Firewallã®å…·ä½“çš„ãªæ©Ÿèƒ½ã‚»ãƒƒãƒˆã¯è¦ç¢ºèª(ãƒ‰ãƒ©ãƒ•ãƒˆç‰ˆ)
            </p>

            <table>
                <thead>
                    <tr style="background-color: #1e88e5; color: white;">
                        <th>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½</th>
                        <th>èª¬æ˜</th>
                        <th style="text-align: center;">ç¾çŠ¶<br>(USEN/Vario Secure)</th>
                        <th style="text-align: center;">IIJ Omnibus<br>(Cloud UTM)</th>
                        <th>å°å…¥ãƒ¡ãƒªãƒƒãƒˆ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background-color: #f9f9f9;">
                        <td><strong>ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«</strong></td>
                        <td>ä¸æ­£ãªé€šä¿¡ã‚’ãƒ–ãƒ­ãƒƒã‚¯</td>
                        <td style="text-align: center;">âœ… ã‚ã‚Š<br><small>(åŸºæœ¬çš„ãªãƒ‘ã‚±ãƒƒãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°)</small></td>
                        <td class="highlight-green" style="text-align: center;">âœ…
                            ã‚ã‚Š<br><small>(é«˜åº¦ãªã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚·ãƒ§ãƒ³)</small></td>
                        <td>ã‚ˆã‚Šç²¾å¯†ãªåˆ¶å¾¡ãŒå¯èƒ½</td>
                    </tr>
                    <tr>
                        <td><strong>IPS/IDS<br><small>(ä¸æ­£ä¾µå…¥æ¤œçŸ¥/é˜²å¾¡)</small></strong></td>
                        <td>æ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œçŸ¥ã—ã¦ãƒ–ãƒ­ãƒƒã‚¯</td>
                        <td class="highlight-orange" style="text-align: center;">â“ ä¸æ˜<br><small>(è¦ç¢ºèª)</small></td>
                        <td class="highlight-green" style="text-align: center;">âœ… ã‚ã‚Š<br><small>(æœ€æ–°ã®æ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³ã«è‡ªå‹•å¯¾å¿œ)</small>
                        </td>
                        <td>SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã€ã‚¼ãƒ­ãƒ‡ã‚¤æ”»æ’ƒç­‰ã‚’é˜²å¾¡</td>
                    </tr>
                    <tr style="background-color: #f9f9f9;">
                        <td><strong>ã‚¢ãƒ³ãƒã‚¦ã‚¤ãƒ«ã‚¹<br><small>(ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãƒ¬ãƒ™ãƒ«)</small></strong></td>
                        <td>ã‚¦ã‚¤ãƒ«ã‚¹ãƒ»ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚’æ¤œå‡ºãƒ»é™¤å»</td>
                        <td class="highlight-red" style="text-align: center;">âŒ ãªã—<br><small>(ç«¯æœ«å´ã®ã¿ã§å¯¾å¿œ)</small></td>
                        <td class="highlight-green" style="text-align: center;">âœ… ã‚ã‚Š<br><small>(ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¬ãƒ™ãƒ«ã§ã‚¹ã‚­ãƒ£ãƒ³)</small>
                        </td>
                        <td>ç«¯æœ«ã«åˆ°é”ã™ã‚‹å‰ã«ãƒ–ãƒ­ãƒƒã‚¯</td>
                    </tr>
                    <tr>
                        <td><strong>Webãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</strong></td>
                        <td>å±é™ºãªWebã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯</td>
                        <td class="highlight-red" style="text-align: center;">âŒ ãªã—</td>
                        <td class="highlight-green" style="text-align: center;">âœ…
                            ã‚ã‚Š<br><small>(ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ãƒ»ãƒãƒ«ã‚¦ã‚§ã‚¢é…å¸ƒã‚µã‚¤ãƒˆç­‰)</small></td>
                        <td>å¾“æ¥­å“¡ã®èª¤ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²æ­¢</td>
                    </tr>
                    <tr style="background-color: #f9f9f9;">
                        <td><strong>SSL/TLSæ¤œæŸ»</strong></td>
                        <td>æš—å·åŒ–é€šä¿¡ã®ä¸­èº«ã‚‚ãƒã‚§ãƒƒã‚¯</td>
                        <td class="highlight-red" style="text-align: center;">âŒ ãªã—<br><small>âš ï¸ æš—å·åŒ–ã•ã‚ŒãŸè„…å¨ã‚’æ¤œçŸ¥ã§ããªã„</small>
                        </td>
                        <td class="highlight-green" style="text-align: center;">âœ… ã‚ã‚Š<br><small>(HTTPSé€šä¿¡ã‚‚æ¤œæŸ»å¯èƒ½)</small>
                        </td>
                        <td><strong>ç¾ä»£ã®æ”»æ’ƒã®å¤§åŠã¯HTTPSã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚å¿…é ˆ</strong></td>
                    </tr>
                    <tr>
                        <td><strong>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡</strong></td>
                        <td>ç‰¹å®šã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆ©ç”¨ã‚’åˆ¶é™</td>
                        <td class="highlight-red" style="text-align: center;">âŒ ãªã—</td>
                        <td class="highlight-green" style="text-align: center;">âœ…
                            ã‚ã‚Š<br><small>(P2Pã‚½ãƒ•ãƒˆã€æ¥­å‹™å¤–ã‚¢ãƒ—ãƒªç­‰ã‚’åˆ¶é™)</small></td>
                        <td>å¸¯åŸŸã®ç„¡é§„é£ã„ã‚’é˜²æ­¢</td>
                    </tr>
                    <tr style="background-color: #f9f9f9;">
                        <td><strong>DDoSå¯¾ç­–</strong></td>
                        <td>å¤§é‡ã‚¢ã‚¯ã‚»ã‚¹æ”»æ’ƒã‹ã‚‰ã®ä¿è­·</td>
                        <td class="highlight-red" style="text-align: center;">âŒ ãªã—</td>
                        <td class="highlight-green" style="text-align: center;">âœ… ã‚ã‚Š<br><small>(ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¬ãƒ™ãƒ«ã§å¸å)</small></td>
                        <td>ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ãƒªã‚¹ã‚¯ã‚’è»½æ¸›</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="margin-top: 40px;">æ‹ ç‚¹åˆ¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŠ¶æ³</h3>
            <table>
                <thead>
                    <tr style="background-color: #43a047; color: white;">
                        <th>æ‹ ç‚¹</th>
                        <th>ç¾çŠ¶ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</th>
                        <th>å•é¡Œç‚¹</th>
                        <th>IIJ Omnibuså°å…¥å¾Œ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background-color: #f9f9f9;">
                        <td><strong>ç¯‰åœ°æœ¬ç¤¾(Hub)</strong></td>
                        <td>âœ… åŸºæœ¬çš„ãªFW</td>
                        <td>é«˜åº¦ãªè„…å¨ã«å¯¾å¿œã§ããªã„</td>
                        <td class="highlight-green">âœ… å…¨æ©Ÿèƒ½é©ç”¨</td>
                    </tr>
                    <tr>
                        <td><strong>å¤§é˜ªæ”¯åº—</strong></td>
                        <td class="highlight-red">âœ… Vario Secure (VSR600)<br><small>æœ¬ç¤¾ã¨åŒç­‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«</small></td>
                        <td>è¨­å®šãŒæœ¬ç¤¾ã¨åˆ¥ç®¡ç†(ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹2ç®‡æ‰€)</td>
                        <td class="highlight-green">âœ… å…¨æ©Ÿèƒ½é©ç”¨<br><strong>ä¸€å…ƒç®¡ç†</strong></td>
                    </tr>
                    <tr style="background-color: #f9f9f9;">
                        <td><strong>ãã®ä»–æ”¯åº—<br>(æ©‹æœ¬å«ã‚€)</strong></td>
                        <td>âœ… ç¯‰åœ°æœ¬ç¤¾FWçµŒç”±</td>
                        <td>ç¯‰åœ°çµŒç”±ã§é…å»¶ç™ºç”Ÿ</td>
                        <td class="highlight-green">âœ… å…¨æ©Ÿèƒ½é©ç”¨<br><strong>é«˜é€ŸåŒ–ã‚‚å®Ÿç¾</strong></td>
                    </tr>
                </tbody>
            </table>

            <h3 style="margin-top: 40px;">ã‚³ã‚¹ãƒˆ vs ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ç·åˆæ¯”è¼ƒ</h3>
            <table>
                <thead>
                    <tr style="background-color: #e65100; color: white;">
                        <th>é …ç›®</th>
                        <th style="text-align: center;">ç¾çŠ¶ (USEN/Vario Secure)</th>
                        <th style="text-align: center;">IIJ Omnibus (Cloud UTM)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background-color: #f9f9f9;">
                        <td><strong>æœˆé¡ã‚³ã‚¹ãƒˆ</strong></td>
                        <td style="text-align: center;">ç´„11.8ä¸‡å††</td>
                        <td class="highlight-orange" style="text-align: center;">ç´„72ä¸‡å†† <strong>(ç´„6å€)</strong></td>
                    </tr>
                    <tr>
                        <td><strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«</strong></td>
                        <td style="text-align: center;">â­â­â˜†â˜†â˜†<br><small>åŸºæœ¬çš„ãªFWã®ã¿</small></td>
                        <td class="highlight-green" style="text-align: center;">â­â­â­â­â­<br><small>8ã¤ã®æ©Ÿèƒ½ã§å¤šå±¤é˜²å¾¡</small></td>
                    </tr>
                    <tr style="background-color: #f9f9f9;">
                        <td><strong>å…¨æ‹ ç‚¹å‡ä¸€æ€§</strong></td>
                        <td style="text-align: center;">âœ… å‡ä¸€<br><small>ãŸã ã—å¤§é˜ªã¯åˆ¥ç®¡ç†</small></td>
                        <td class="highlight-green" style="text-align: center;">âœ… å®Œå…¨å‡ä¸€<br><small>ä¸€å…ƒç®¡ç†</small></td>
                    </tr>
                    <tr>
                        <td><strong>é‹ç”¨è² è·</strong></td>
                        <td style="text-align: center;">ã‚¼ãƒ­<br><small>(Vario SecureãŒãƒ•ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ‰)</small></td>
                        <td class="highlight-green" style="text-align: center;">ã‚¼ãƒ­<br><small>(IIJãŒè‡ªå‹•ç®¡ç†)</small></td>
                    </tr>
                    <tr style="background-color: #f9f9f9;">
                        <td><strong>å¯è¦–åŒ–</strong></td>
                        <td style="text-align: center;">âœ… ã‚ã‚Š<br><small>(ç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æä¾›)</small></td>
                        <td class="highlight-green" style="text-align: center;">âœ… å…¨æ‹ ç‚¹ã®é€šä¿¡ãƒ­ã‚°ã‚’ä¸€å…ƒç®¡ç†</td>
                    </tr>
                </tbody>
            </table>

            <div
                style="margin-top: 30px; padding: 20px; background-color: #fff3e0; border-left: 4px solid #ff9800; border-radius: 4px;">
                <h4 style="margin-top: 0; color: #e65100;">çµè«–</h4>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li><strong>ã‚³ã‚¹ãƒˆã¯ç´„6å€</strong>ã ãŒã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ã¯<strong>5å€ä»¥ä¸Š</strong></li>
                    <li><strong>é‹ç”¨è² è·ã‚¼ãƒ­</strong>(ç¾çŠ¶ã‚‚ã‚¼ãƒ­ã€å¤‰ã‚ã‚‰ãš)</li>
                    <li><strong>å¤§é˜ªã®åˆ¥ç®¡ç†ã‚’è§£æ¶ˆ</strong>(ä¸€å…ƒç®¡ç†)</li>
                    <li><strong>å°†æ¥çš„ãªãƒªã‚¹ã‚¯å›é¿</strong>(ãƒ©ãƒ³ã‚µãƒ ã‚¦ã‚§ã‚¢ã€æƒ…å ±æ¼æ´©ç­‰)</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const baseNodes = [
            { id: "internet", label: "ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ & ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹", type: "cloud", x: 450, y: 100 },
            { id: "tokyo", label: "Tsukiji (Hub)", type: "hub", x: 450, y: 360 },
            { id: "osaka", label: "Osaka", type: "branch", x: 200, y: 500 },
            { id: "rnd", label: "R&D Center", type: "branch", x: 325, y: 500 },
            { id: "fukuoka", label: "Fukuoka", type: "branch", x: 575, y: 500 },
            { id: "wakayama", label: "Wakayama", type: "branch", x: 700, y: 500 },
            { id: "hashimoto", label: "Hashimoto", type: "branch", x: 800, y: 450 },
            { id: "kyobashi", label: "Kyobashi", type: "branch", x: 700, y: 400 },
            { id: "nagoya", label: "Nagoya", type: "branch", x: 380, y: 550 }
        ];

        const cloudUtmNode = { id: "cloud_utm", label: "IIJ Cloud UTM", type: "utm", x: 450, y: 220 };

        let nodes = [...baseNodes];
        let currentMode = 'current';

        const width = 900;
        const height = 600;
        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("viewBox", `0 0 ${width} ${height}`);

        const gLinks = svg.append("g").attr("class", "links");
        const gTraffic = svg.append("g").attr("class", "traffic");
        const gSecurity = svg.append("g").attr("class", "security");
        const gNodes = svg.append("g").attr("class", "nodes");

        const colors = {
            cloud: "#4285F4",
            hub: "#EA4335",
            hub_safe: "#34A853",
            branch: "#FBBC05",
            fw: "#d93025",
            utm: "#188038",
            risk: "#f9ab00"
        };

        function renderNodes() {
            const nodeGroups = gNodes.selectAll("g")
                .data(nodes, d => d.id)
                .join(
                    enter => {
                        const g = enter.append("g")
                            .attr("transform", d => `translate(${d.x},${d.y})`)
                            .attr("opacity", 0);

                        g.append("circle")
                            .attr("r", d => d.type === 'cloud' ? 40 : (d.type === 'utm' ? 35 : (d.type === 'hub' ? 30 : 15)))
                            .attr("fill", d => {
                                if (d.type === 'hub') return colors.hub;
                                if (d.type === 'utm') return colors.utm;
                                return colors[d.type];
                            })
                            .attr("stroke", "white")
                            .attr("stroke-width", 3)
                            .attr("class", "node-circle")
                            .style("filter", "drop-shadow(0px 3px 3px rgba(0,0,0,0.2))");

                        g.append("text")
                            .attr("dy", 5)
                            .attr("text-anchor", "middle")
                            .attr("fill", "white")
                            .attr("font-weight", "bold")
                            .attr("font-size", d => d.type === 'cloud' ? "14px" : (d.type === 'utm' ? "16px" : "12px"))
                            .style("pointer-events", "none")
                            .text(d => {
                                if (d.type === 'cloud') return "â˜ï¸";
                                if (d.type === 'utm') return "ğŸ›¡ï¸";
                                if (d.type === 'hub') return "ğŸ¢";
                                return "ğŸ¢";
                            });

                        g.append("text")
                            .attr("dy", d => d.type === 'cloud' ? -50 : (d.type === 'utm' ? -45 : (d.type === 'hub' ? -40 : 25)))
                            .attr("text-anchor", "middle")
                            .attr("fill", "#333")
                            .attr("font-weight", "bold")
                            .attr("font-size", "12px")
                            .text(d => d.label);

                        return g.transition().duration(500).attr("opacity", 1);
                    },
                    update => update,
                    exit => exit.transition().duration(500).attr("opacity", 0).remove()
                );

            const tooltip = d3.select("#tooltip");
            gNodes.selectAll("g").on("mouseover", (event, d) => {
                tooltip.style("opacity", 1)
                    .html(`<strong>${d.label}</strong><br>Type: ${d.type}`);
            }).on("mousemove", (event) => {
                tooltip.style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY + 10) + "px");
            }).on("mouseout", () => {
                tooltip.style("opacity", 0);
            });
        }

        renderNodes();

        function drawLinks() {
            let links = [];
            if (currentMode === 'current') {
                links.push({ source: "tokyo", target: "internet", type: "bottleneck" });
                links.push({ source: "osaka", target: "internet", type: "breakout" });
                links.push({ source: "osaka", target: "tokyo", type: "vpn" });

                baseNodes.filter(n => n.type === 'branch' && n.id !== 'osaka').forEach(n => {
                    links.push({ source: n.id, target: "tokyo", type: "vpn" });
                });
            } else {
                links.push({ source: "cloud_utm", target: "internet", type: "utm_to_internet" });
                links.push({ source: "tokyo", target: "cloud_utm", type: "breakout" });
                baseNodes.filter(n => n.type === 'branch').forEach(n => {
                    links.push({ source: n.id, target: "cloud_utm", type: "breakout" });
                    links.push({ source: n.id, target: "tokyo", type: "vpn_light" });
                });
            }

            const linkElements = gLinks.selectAll("line")
                .data(links, d => d.source + "-" + d.target + "-" + d.type)
                .join(
                    enter => enter.append("line")
                        .attr("stroke-width", 2)
                        .attr("opacity", 0)
                        .call(enter => enter.transition().duration(500).attr("opacity", 1)),
                    update => update,
                    exit => exit.transition().duration(500).attr("opacity", 0).remove()
                );

            linkElements
                .attr("x1", d => nodes.find(n => n.id === d.source).x)
                .attr("y1", d => nodes.find(n => n.id === d.source).y)
                .attr("x2", d => nodes.find(n => n.id === d.target).x)
                .attr("y2", d => nodes.find(n => n.id === d.target).y)
                .attr("stroke", d => {
                    if (d.type === 'bottleneck') return "#EA4335";
                    if (d.type === 'breakout') return "#34A853";
                    if (d.type === 'vpn_light') return "#ccc";
                    return "#999";
                })
                .attr("stroke-width", d => d.type === 'bottleneck' ? 4 : (d.type === 'breakout' ? 3 : 1))
                .attr("stroke-dasharray", d => d.type === 'vpn_light' ? "4 4" : "none");

            d3.selectAll(".node-circle")
                .filter(d => d.id === 'tokyo')
                .transition().duration(500)
                .attr("fill", currentMode === 'current' ? colors.hub : colors.hub_safe);

            drawSecurity();
            return links;
        }

        function drawSecurity() {
            gSecurity.selectAll("*").remove();

            if (currentMode === 'current') {
                gSecurity.append("rect")
                    .attr("x", 420).attr("y", 210)
                    .attr("width", 60).attr("height", 20)
                    .attr("fill", colors.fw)
                    .attr("rx", 5)
                    .style("filter", "drop-shadow(0px 2px 2px rgba(0,0,0,0.3))");

                gSecurity.append("text")
                    .attr("x", 450).attr("y", 224)
                    .attr("text-anchor", "middle")
                    .attr("fill", "white")
                    .attr("font-size", "10px")
                    .attr("font-weight", "bold")
                    .text("Legacy FW");

                gSecurity.append("text")
                    .attr("x", 200).attr("y", 480)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "10px")
                    .attr("fill", "#188038")
                    .attr("font-weight", "bold")
                    .text("ğŸ›¡ï¸ Secure (Vario)");
            } else {
                baseNodes.filter(n => n.type === 'branch').forEach(n => {
                    gSecurity.append("text")
                        .attr("x", n.x + 10).attr("y", n.y - 10)
                        .attr("font-size", "10px")
                        .text("ğŸ›¡ï¸");
                });

                const labelPositions = [
                    { x: 325, y: 340 },
                    { x: 387, y: 340 },
                    { x: 415, y: 365 },
                    { x: 512, y: 340 },
                    { x: 575, y: 340 },
                    { x: 650, y: 380 },
                    { x: 575, y: 290 }
                ];

                labelPositions.forEach(pos => {
                    gSecurity.append("text")
                        .attr("x", pos.x)
                        .attr("y", pos.y)
                        .attr("text-anchor", "middle")
                        .attr("font-size", "9px")
                        .attr("fill", "#1e7e34")
                        .attr("font-weight", "bold")
                        .attr("opacity", 0.8)
                        .text("LBO");
                });
            }
        }

        function animateTraffic() {
            if (Math.random() > 0.3) return;

            const branches = baseNodes.filter(n => n.type === 'branch');
            const startNode = branches[Math.floor(Math.random() * branches.length)];

            let path = [];
            if (currentMode === 'current') {
                if (startNode.id === 'osaka') {
                    path = [startNode, nodes.find(n => n.id === 'internet')];
                } else {
                    path = [startNode, nodes.find(n => n.id === 'tokyo'), nodes.find(n => n.id === 'internet')];
                }
            } else {
                path = [startNode, nodes.find(n => n.id === 'cloud_utm'), nodes.find(n => n.id === 'internet')];
            }

            const particle = gTraffic.append("circle")
                .attr("r", 4)
                .attr("fill", currentMode === 'current' ? (startNode.id === 'osaka' ? '#FFE082' : "#FFCDD2") : "#C8E6C9")
                .attr("cx", path[0].x)
                .attr("cy", path[0].y);

            if (currentMode === 'current' && startNode.id !== 'osaka') {
                particle.transition()
                    .duration(1000)
                    .ease(d3.easeLinear)
                    .attr("cx", path[1].x)
                    .attr("cy", path[1].y)
                    .transition()
                    .duration(500)
                    .ease(d3.easeLinear)
                    .attr("cx", path[2].x)
                    .attr("cy", path[2].y)
                    .remove();
            } else {
                particle.transition()
                    .duration(700)
                    .ease(d3.easeLinear)
                    .attr("cx", path[1].x)
                    .attr("cy", path[1].y)
                    .transition()
                    .duration(400)
                    .ease(d3.easeLinear)
                    .attr("cx", path[2] ? path[2].x : path[1].x)
                    .attr("cy", path[2] ? path[2].y : path[1].y)
                    .remove();
            }
        }

        let trafficInterval;
        function startAnimation() {
            if (trafficInterval) clearInterval(trafficInterval);
            trafficInterval = setInterval(animateTraffic, 100);
            drawLinks();
            drawSecurity();
        }

        function setMode(mode) {
            currentMode = mode;

            if (mode === 'future') {
                nodes = [...baseNodes, cloudUtmNode];
            } else {
                nodes = [...baseNodes];
            }

            renderNodes();
            d3.selectAll(".toggle-btn").classed("active", false);
            d3.select(`#btn-${mode}`).classed("active", true);
            drawLinks();
            updateDescription(mode);
        }

        function updateDescription(mode) {
            const descBox = document.getElementById("description-box");
            if (mode === 'future') {
                descBox.style.display = "block";
                descBox.innerHTML = `
                <h3 style="margin-top:0; color:#188038;">ğŸ›¡ï¸ Cloud UTM / ZTNA ã¨ã¯ï¼Ÿ</h3>
                <ul style="padding-left:20px; margin-bottom:0;">
                    <li><strong>ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ¬ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆ (Local Breakout):</strong> å„æ‹ ç‚¹ã‹ã‚‰ç›´æ¥ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸æ¥ç¶šã€‚æœ¬ç¤¾ã‚’çµŒç”±ã—ãªã„ãŸã‚ã€é…å»¶ã‚’è§£æ¶ˆã—ã€å¸¯åŸŸã‚’åŠ¹ç‡çš„ã«åˆ©ç”¨ã§ãã¾ã™ã€‚</li>
                    <li><strong>è„±ãƒ»ç‰©ç†ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«:</strong> æœ¬ç¤¾ã®ç‰©ç†æ©Ÿå™¨(ãƒœãƒˆãƒ«ãƒãƒƒã‚¯)ã‚’æ’¤å»ƒã—ã€ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã§ä¸€æ‹¬ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã€‚</li>
                    <li><strong>å…¨æ‹ ç‚¹å‡ä¸€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£:</strong> å…¨æ‹ ç‚¹ã§åŒã˜é«˜ãƒ¬ãƒ™ãƒ«ãªå®‰å…¨æ€§ã‚’ç¢ºä¿ã€‚</li>
                    <li><strong>ã‚³ã‚¹ãƒˆ/é‹ç”¨æœ€é©åŒ–:</strong> æ©Ÿå™¨ç®¡ç†ä¸è¦ã§ã€é‹ç”¨è² è·ã‚’åŠ‡çš„ã«è»½æ¸›ã€‚(ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆã®å®Ÿç¾)</li>
                </ul>
            `;
            } else {
                descBox.style.display = "none";
            }
        }

        startAnimation();
    </script>
</body>

</html>